<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Dashboard | Overview</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --primary-indigo: #6366f1;
        --secondary-purple: #4f46e5;
        --accent-purple: #8b5cf6;
        --success-green: #10b981;
        --warning-orange: #f59e0b;
        --info-blue: #3b82f6;
        --error-red: #ef4444;
        --dark-text: #111827;
        --medium-text: #374151;
        --light-text: #6b7280;
        --white: #ffffff;
        --sidebar-width: 250px;
        --navbar-height: 70px;

        /* Light mode colors (default) */
        --bg-primary: #f8fafc;
        --bg-secondary: #e0e7ff;
        --bg-tertiary: #f3e8ff;
        --card-bg: rgba(255, 255, 255, 0.8);
        --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        --navbar-bg: rgba(255, 255, 255, 0.8);
        --text-primary: #111827;
        --text-secondary: #374151;
        --text-muted: #6b7280;
        --border-color: rgba(0, 0, 0, 0.1);
        --skeleton-bg: rgba(0, 0, 0, 0.1);
      }

      /* Dark mode colors */
      [data-theme="dark"] {
        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
        --bg-tertiary: #334155;
        --card-bg: rgba(30, 41, 59, 0.8);
        --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        --navbar-bg: rgba(30, 41, 59, 0.8);
        --text-primary: #f8fafc;
        --text-secondary: #cbd5e1;
        --text-muted: #94a3b8;
        --border-color: rgba(255, 255, 255, 0.1);
        --skeleton-bg: rgba(255, 255, 255, 0.1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(
          135deg,
          var(--bg-primary),
          var(--bg-secondary),
          var(--bg-tertiary)
        );
        color: var(--text-primary);
        display: flex;
        min-height: 100vh;
        transition: background 0.3s ease, color 0.3s ease;
        overflow-x: hidden;
      }

      /* Sidebar Styles - Updated for Student */
      .sidebar {
        width: var(--sidebar-width);
        background: linear-gradient(
          180deg,
          var(--primary-indigo),
          var(--secondary-purple),
          var(--primary-indigo)
        );
        color: var(--white);
        height: 100vh;
        position: fixed;
        transition: all 0.3s;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        overflow: hidden;
        transform: translateX(0);
        display: flex;
        flex-direction: column;
      }

      .sidebar::before {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 200px;
        height: 200px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        transform: translate(40%, -40%);
      }

      .sidebar::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        width: 150px;
        height: 150px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        transform: translate(-40%, 40%);
      }

      .sidebar-header {
        padding: 20px;
        text-align: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .sidebar-header h2 {
        font-size: 1.5rem;
        font-weight: 600;
      }

      .sidebar-menu {
        padding: 20px 0;
        position: relative;
        z-index: 10;
        flex: 1;
      }

      .sidebar-menu ul {
        list-style: none;
      }

      .sidebar-menu li {
        margin-bottom: 5px;
      }

      .sidebar-menu a {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
      }

      .sidebar-menu a::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.1);
        transition: left 0.3s ease;
        z-index: -1;
      }

      .sidebar-menu a:hover::before,
      .sidebar-menu a.active::before {
        left: 0;
      }

      .sidebar-menu a:hover,
      .sidebar-menu a.active {
        color: var(--white);
        border-left: 4px solid var(--white);
      }

      .sidebar-menu i {
        margin-right: 10px;
        font-size: 1.1rem;
        width: 20px;
        text-align: center;
      }

      /* Sidebar Footer */
      .sidebar-footer {
        padding: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        z-index: 10;
      }

      .sidebar-footer .logout-btn {
        background: rgba(255, 255, 255, 0.1);
        color: var(--white);
        border: none;
        padding: 12px 20px;
        border-radius: 5px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        transition: all 0.3s;
        font-size: 1rem;
      }

      .sidebar-footer .logout-btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .sidebar-footer .logout-btn i {
        margin-right: 10px;
      }

      /* Theme Toggle in Sidebar */
      .theme-toggle-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 20px;
        color: rgba(255, 255, 255, 0.8);
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
      }

      .theme-toggle-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.1);
        transition: left 0.3s ease;
        z-index: -1;
      }

      .theme-toggle-item:hover::before {
        left: 0;
      }

      .theme-toggle-item:hover {
        color: var(--white);
      }

      .theme-toggle-label {
        display: flex;
        align-items: center;
      }

      .theme-toggle-label i {
        margin-right: 10px;
        font-size: 1.1rem;
        width: 20px;
        text-align: center;
      }

      /* Toggle Switch */
      .toggle-switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 24px;
      }

      .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(255, 255, 255, 0.2);
        transition: 0.4s;
        border-radius: 24px;
      }

      .toggle-slider:before {
        position: absolute;
        content: "";
        height: 16px;
        width: 16px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        border-radius: 50%;
      }

      input:checked + .toggle-slider {
        background-color: var(--accent-purple);
      }

      input:checked + .toggle-slider:before {
        transform: translateX(26px);
      }

      /* Hamburger Menu Button */
      .hamburger-menu {
        display: none;
        background: none;
        border: none;
        color: var(--white);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 5px;
        border-radius: 4px;
        transition: background-color 0.3s;
      }

      .hamburger-menu:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      /* Main Content Styles */
      .main-content {
        flex: 1;
        margin-left: var(--sidebar-width);
        padding: 20px;
        transition: margin-left 0.3s ease;
      }

      /* Navbar Styles */
      .navbar {
        background-color: var(--navbar-bg);
        height: var(--navbar-height);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 30px;
        box-shadow: var(--card-shadow);
        border-radius: 10px;
        margin-bottom: 30px;
        backdrop-filter: blur(10px);
        transition: background 0.3s ease;
      }

      .navbar-left {
        display: flex;
        align-items: center;
      }

      .navbar-left h1 {
        font-size: 1.5rem;
        color: var(--text-primary);
      }

      .mobile-menu-btn {
        display: none;
        background: none;
        border: none;
        color: var(--text-primary);
        font-size: 1.5rem;
        cursor: pointer;
        margin-right: 15px;
        padding: 5px;
        border-radius: 4px;
        transition: background-color 0.3s;
      }

      .mobile-menu-btn:hover {
        background-color: rgba(0, 0, 0, 0.05);
      }

      [data-theme="dark"] .mobile-menu-btn:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }

      .navbar-right {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .user-info {
        display: flex;
        align-items: center;
        margin-right: 20px;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--primary-indigo),
          var(--secondary-purple)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--white);
        font-weight: bold;
        margin-right: 10px;
      }

      /* Welcome Banner */
      .welcome-banner {
        background: linear-gradient(
          135deg,
          var(--primary-indigo),
          var(--secondary-purple)
        );
        color: var(--white);
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 30px;
        box-shadow: var(--card-shadow);
        position: relative;
        overflow: hidden;
      }

      .welcome-banner::before {
        content: "";
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200px;
        height: 200px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 50%;
      }

      .welcome-banner h2 {
        font-size: 1.8rem;
        margin-bottom: 8px;
        position: relative;
        z-index: 1;
      }

      .welcome-banner p {
        opacity: 0.9;
        position: relative;
        z-index: 1;
      }

      /* Overview Cards - Student Focused */
      .overview-cards {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: auto auto;
        gap: 20px;
        margin-bottom: 30px;
      }

      .overview-cards .card:nth-child(-n + 4) {
        grid-row: 1;
      }

      .overview-cards .card:nth-child(5),
      .overview-cards .card:nth-child(6) {
        grid-row: 2;
        grid-column: span 2;
      }

      .card {
        background: var(--card-bg);
        border-radius: 10px;
        box-shadow: var(--card-shadow);
        padding: 20px;
        transition: transform 0.3s, background 0.3s ease;
        backdrop-filter: blur(10px);
      }

      .card:hover {
        transform: translateY(-5px);
      }

      .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }

      .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
      }

      .card-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--white);
        font-size: 1.2rem;
      }

      .card-content {
        margin-bottom: 15px;
      }

      .stat-number {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .stat-number.primary {
        color: var(--primary-indigo);
      }

      .stat-number.success {
        color: var(--success-green);
      }

      .stat-number.warning {
        color: var(--warning-orange);
      }

      .stat-number.info {
        color: var(--info-blue);
      }

      .stat-label {
        color: var(--text-muted);
        font-size: 0.9rem;
      }

      .card-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      .progress-change {
        display: flex;
        align-items: center;
        font-weight: 600;
      }

      .progress-change.positive {
        color: var(--success-green);
      }

      .progress-change.negative {
        color: var(--error-red);
      }

      /* Upcoming Deadlines Section */
      .deadlines-section {
        margin-bottom: 30px;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .section-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
      }

      .view-all-btn {
        background: none;
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s;
      }

      .view-all-btn:hover {
        background-color: var(--skeleton-bg);
      }

      .deadlines-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
      }

      .deadline-card {
        background: var(--card-bg);
        border-radius: 10px;
        box-shadow: var(--card-shadow);
        padding: 20px;
        transition: transform 0.3s, background 0.3s ease;
        backdrop-filter: blur(10px);
        border-left: 4px solid var(--warning-orange);
      }

      .deadline-card.urgent {
        border-left-color: var(--error-red);
      }

      .deadline-card.completed {
        border-left-color: var(--success-green);
      }

      .deadline-card:hover {
        transform: translateY(-3px);
      }

      .deadline-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
      }

      .deadline-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 5px;
      }

      .deadline-course {
        font-size: 0.9rem;
        color: var(--text-muted);
      }

      .deadline-date {
        background: var(--skeleton-bg);
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        white-space: nowrap;
      }

      .deadline-date.urgent {
        background-color: rgba(239, 68, 68, 0.1);
        color: var(--error-red);
      }

      .deadline-date.near {
        background-color: rgba(245, 158, 11, 0.1);
        color: var(--warning-orange);
      }

      .deadline-progress {
        margin-top: 15px;
      }

      .progress-bar {
        height: 6px;
        background-color: var(--skeleton-bg);
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 8px;
      }

      .progress-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 0.5s ease;
      }

      .progress-fill.pending {
        background-color: var(--warning-orange);
        width: 30%;
      }

      .progress-fill.in-progress {
        background-color: var(--info-blue);
        width: 60%;
      }

      .progress-fill.completed {
        background-color: var(--success-green);
        width: 100%;
      }

      .progress-text {
        display: flex;
        justify-content: space-between;
        font-size: 0.8rem;
        color: var(--text-muted);
      }

      /* Recent Activity Section */
      .activity-section {
        margin-bottom: 30px;
      }

      .activity-list {
        background: var(--card-bg);
        border-radius: 10px;
        box-shadow: var(--card-shadow);
        overflow: hidden;
        backdrop-filter: blur(10px);
      }

      .activity-item {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 1px solid var(--border-color);
        transition: background 0.3s;
      }

      .activity-item:last-child {
        border-bottom: none;
      }

      .activity-item:hover {
        background-color: var(--skeleton-bg);
      }

      .activity-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 15px;
        font-size: 1rem;
      }

      .activity-icon.course {
        background: rgba(99, 102, 241, 0.1);
        color: var(--primary-indigo);
      }

      .activity-icon.assignment {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning-orange);
      }

      .activity-icon.quiz {
        background: rgba(59, 130, 246, 0.1);
        color: var(--info-blue);
      }

      .activity-icon.completed {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success-green);
      }

      .activity-content {
        flex: 1;
      }

      .activity-title {
        font-weight: 600;
        margin-bottom: 4px;
        color: var(--text-primary);
      }

      .activity-desc {
        font-size: 0.9rem;
        color: var(--text-muted);
      }

      .activity-time {
        font-size: 0.8rem;
        color: var(--text-muted);
        white-space: nowrap;
      }

      /* Performance Chart Section */
      .performance-section {
        margin-bottom: 30px;
      }

      .performance-chart {
        background: var(--card-bg);
        border-radius: 10px;
        box-shadow: var(--card-shadow);
        padding: 25px;
        backdrop-filter: blur(10px);
      }

      .chart-container {
        height: 250px;
        position: relative;
        margin-top: 20px;
      }

      /* Toast Notification Styles */
      .toast-container {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 10000;
        max-width: 400px;
        pointer-events: none;
      }

      .toast {
        background: var(--card-bg);
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        padding: 16px;
        margin-bottom: 10px;
        border-left: 4px solid;
        display: flex;
        align-items: center;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease;
        pointer-events: all;
        max-width: 350px;
        backdrop-filter: blur(10px);
        transition: background 0.3s ease;
      }

      .toast.show {
        opacity: 1;
        transform: translateX(0);
      }

      .toast.hide {
        opacity: 0;
        transform: translateX(100%);
      }

      .toast-icon {
        margin-right: 12px;
        font-size: 20px;
        flex-shrink: 0;
      }

      .toast-content {
        flex: 1;
        min-width: 0;
      }

      .toast-title {
        font-weight: bold;
        margin-bottom: 4px;
        color: var(--text-primary);
      }

      .toast-message {
        color: var(--text-secondary);
        font-size: 14px;
        line-height: 1.4;
      }

      .toast-close {
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
        color: var(--text-muted);
        margin-left: 12px;
        flex-shrink: 0;
        padding: 4px;
      }

      .toast-close:hover {
        color: var(--text-primary);
      }

      /* Loading Spinner */
      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Loading State - Skeleton Screens */
      .skeleton-loading {
        position: relative;
        overflow: hidden;
      }

      .skeleton-loading::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        transform: translateX(-100%);
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0) 0,
          rgba(255, 255, 255, 0.2) 50%,
          rgba(255, 255, 255, 0) 100%
        );
        animation: shimmer 1.5s infinite;
      }

      @keyframes shimmer {
        100% {
          transform: translateX(100%);
        }
      }

      .skeleton-card {
        background-color: var(--skeleton-bg);
        border-radius: 10px;
        height: 24px;
        margin-bottom: 8px;
      }

      .skeleton-card.small {
        height: 16px;
        width: 60%;
      }

      .skeleton-card.medium {
        height: 20px;
        width: 80%;
      }

      .skeleton-card.large {
        height: 32px;
        width: 100%;
      }

      .skeleton-circle {
        background-color: var(--skeleton-bg);
        border-radius: 50%;
        width: 40px;
        height: 40px;
      }

      .skeleton-stat {
        background-color: var(--skeleton-bg);
        border-radius: 8px;
        height: 40px;
        margin-bottom: 5px;
      }

      .skeleton-footer {
        background-color: var(--skeleton-bg);
        border-radius: 4px;
        height: 12px;
        width: 40%;
      }

      /* Loading State */
      .loading-state {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px;
        color: var(--text-muted);
      }

      .loading-state i {
        margin-right: 8px;
      }

      .loading-text {
        font-style: italic;
      }

      /* Error State */
      .error {
        color: var(--error-red);
        font-size: 0.9rem;
      }

      /* Logout Confirmation Modal Styles */
      .confirmation-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 2000;
        overflow-y: auto;
      }

      .confirmation-content {
        background-color: var(--card-bg);
        margin: 200px auto;
        padding: 30px;
        border-radius: 12px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        position: relative;
        text-align: center;
        backdrop-filter: blur(10px);
        transition: background 0.3s ease;
      }

      .confirmation-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--primary-indigo),
          var(--secondary-purple)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--white);
        font-size: 1.5rem;
        margin: 0 auto 20px;
      }

      .confirmation-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 10px;
      }

      .confirmation-message {
        color: var(--text-muted);
        margin-bottom: 25px;
        font-size: 1rem;
      }

      .confirmation-actions {
        display: flex;
        justify-content: center;
        gap: 15px;
      }

      .confirm-no {
        background-color: var(--text-muted);
        color: var(--white);
        border: none;
        padding: 12px 25px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.3s;
        min-width: 100px;
      }

      .confirm-no:hover {
        opacity: 0.9;
      }

      .confirm-yes {
        background: linear-gradient(
          135deg,
          var(--primary-indigo),
          var(--secondary-purple)
        );
        color: var(--white);
        border: none;
        padding: 12px 25px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.3s;
        min-width: 100px;
      }

      .confirm-yes:hover {
        opacity: 0.9;
      }

      /* Colors */
      .bg-primary {
        background: linear-gradient(
          135deg,
          var(--primary-indigo),
          var(--secondary-purple)
        );
      }
      .bg-success {
        background: linear-gradient(135deg, var(--success-green), #059669);
      }
      .bg-warning {
        background: linear-gradient(135deg, var(--warning-orange), #d97706);
      }
      .bg-info {
        background: linear-gradient(135deg, var(--info-blue), #2563eb);
      }
      .bg-error {
        background: linear-gradient(135deg, var(--error-red), #dc2626);
      }

      /* Mobile Responsive Styles */
      @media (max-width: 1200px) {
        .overview-cards {
          grid-template-columns: repeat(2, 1fr);
          grid-template-rows: repeat(3, auto);
        }

        .overview-cards .card:nth-child(-n + 4) {
          grid-row: auto;
          grid-column: span 1;
        }

        .overview-cards .card:nth-child(5),
        .overview-cards .card:nth-child(6) {
          grid-row: auto;
          grid-column: span 1;
        }
      }

      @media (max-width: 992px) {
        .sidebar {
          transform: translateX(-100%);
          width: 280px;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .sidebar-header h2 {
          display: block;
        }

        .sidebar-menu span {
          display: inline;
        }

        .sidebar-menu a {
          justify-content: flex-start;
          padding: 12px 20px;
        }

        .sidebar-menu i {
          margin-right: 10px;
          font-size: 1.1rem;
        }

        .hamburger-menu {
          display: block;
        }

        .mobile-menu-btn {
          display: block;
        }

        .main-content {
          margin-left: 0;
          width: 100%;
        }

        .overlay {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.5);
          z-index: 999;
          display: none;
        }

        .overlay.active {
          display: block;
        }

        .navbar-left h1 {
          font-size: 1.2rem !important;
        }
      }

      @media (max-width: 768px) {
        .deadlines-grid {
          grid-template-columns: 1fr;
        }

        .overview-cards {
          grid-template-columns: 1fr;
          grid-template-rows: repeat(6, auto);
        }

        .overview-cards .card:nth-child(-n + 4),
        .overview-cards .card:nth-child(5),
        .overview-cards .card:nth-child(6) {
          grid-row: auto;
          grid-column: span 1;
        }

        .navbar {
          padding: 0 15px;
        }

        .user-info span {
          display: none;
        }

        .navbar-left h1 {
          font-size: 1.2rem !important;
        }

        /* Mobile-specific dashboard optimizations */
        .overview-cards {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .card {
          padding: 15px;
          display: flex;
          flex-direction: column;
        }

        .card-header {
          margin-bottom: 10px;
          flex-wrap: wrap;
        }

        .card-title {
          font-size: 1rem;
        }

        .card-icon {
          width: 35px;
          height: 35px;
          font-size: 1rem;
        }

        .card-content {
          margin-bottom: 10px;
        }

        .stat-number {
          font-size: 1.5rem;
        }

        .stat-label {
          font-size: 0.8rem;
        }

        .card-footer {
          font-size: 0.75rem;
        }

        .welcome-banner {
          padding: 20px;
        }

        .welcome-banner h2 {
          font-size: 1.5rem;
        }

        .section-title {
          font-size: 1.3rem;
        }

        .deadline-card {
          padding: 15px;
        }

        .activity-item {
          padding: 12px 15px;
        }

        .performance-chart {
          padding: 20px;
        }

        .chart-container {
          height: 200px;
        }
      }

      @media (max-width: 480px) {
        .main-content {
          padding: 15px;
        }

        .navbar {
          padding: 0 10px;
          margin-bottom: 20px;
        }

        .navbar-left h1 {
          font-size: 1rem !important;
          font-weight: 600;
        }

        .user-avatar {
          width: 35px;
          height: 35px;
        }

        .overview-cards {
          gap: 12px;
        }

        .card {
          padding: 12px;
        }

        .welcome-banner {
          padding: 15px;
        }

        .welcome-banner h2 {
          font-size: 1.3rem;
        }

        .deadline-card {
          padding: 12px;
        }

        .activity-item {
          padding: 10px 12px;
        }

        .performance-chart {
          padding: 15px;
        }

        .chart-container {
          height: 180px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Overlay for mobile sidebar -->
    <div class="overlay" id="overlay"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h2>EduStudent</h2>
        <button class="hamburger-menu" id="hamburgerMenu">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="sidebar-menu">
        <ul>
          <li>
            <a href="student-dashboard-overview.html" class="active">
              <i class="fas fa-chart-pie"></i>
              <span>Overview</span>
            </a>
          </li>
          <li>
            <a href="student-courses.html">
              <i class="fas fa-book"></i>
              <span>Courses</span>
            </a>
          </li>
          <li>
            <a href="student-lessons.html">
              <i class="fas fa-chalkboard-teacher"></i>
              <span>Lessons</span>
            </a>
          </li>
          <li>
            <a href="student-assignments.html">
              <i class="fas fa-tasks"></i>
              <span>Assignments</span>
            </a>
          </li>
          <li>
            <a href="student-quiz.html">
              <i class="fas fa-chart-bar"></i>
              <span>Quizzes</span>
            </a>
          </li>
          <li>
            <a href="student-grades.html">
              <i class="fas fa-chart-bar"></i>
              <span>Grades</span>
            </a>
          </li>
          <li>
            <a href="student-progress.html">
              <i class="fas fa-trophy"></i>
              <span>Progress</span>
            </a>
          </li>
          <li>
            <a href="student-resources.html">
              <i class="fas fa-folder"></i>
              <span>Resources</span>
            </a>
          </li>
          <!-- Theme Toggle in Sidebar -->
          <li class="theme-toggle-item" id="sidebarThemeToggle">
            <div class="theme-toggle-label">
              <i class="fas fa-palette"></i>
              <span>Theme</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="themeToggleInput" />
              <span class="toggle-slider"></span>
            </label>
          </li>
        </ul>
      </div>

      <!-- Sidebar Footer with Logout Button -->
      <div class="sidebar-footer">
        <button class="logout-btn" id="sidebarLogoutBtn">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Navbar -->
      <div class="navbar">
        <div class="navbar-left">
          <button class="mobile-menu-btn" id="mobileMenuBtn">
            <i class="fas fa-bars"></i>
          </button>
          <h1>Student Dashboard</h1>
        </div>
        <div class="navbar-right">
          <div class="user-info">
            <div class="user-avatar" id="currentUserAvatar">JD</div>
            <span id="currentUserName">John Doe</span>
          </div>
        </div>
      </div>

      <!-- Welcome Banner -->
      <div class="welcome-banner">
        <h2 id="welcomeMessage">Welcome back, John!</h2>
        <p id="welcomeSubtitle">
          You have <span id="pendingCount">3</span> pending assignments and
          <span id="upcomingCount">2</span> upcoming deadlines.
        </p>
      </div>

      <!-- Overview Cards -->
      <div class="overview-cards">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Enrolled Courses</div>
            <div class="card-icon bg-primary">
              <i class="fas fa-book"></i>
            </div>
          </div>
          <div class="card-content">
            <div
              class="stat-number primary skeleton-loading"
              id="enrolled-courses"
            >
              <div class="skeleton-card large"></div>
            </div>
            <div class="stat-label">Active courses this semester</div>
          </div>
          <div class="card-footer">
            <span>Last updated: <span id="courses-updated">Today</span></span>
            <span class="progress-change positive" id="courses-change">
              <i class="fas fa-arrow-up"></i>
              <span id="courses-percentage" class="skeleton-loading">
                <div class="skeleton-card small"></div>
              </span>
            </span>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Pending Assignments</div>
            <div class="card-icon bg-warning">
              <i class="fas fa-clock"></i>
            </div>
          </div>
          <div class="card-content">
            <div
              class="stat-number warning skeleton-loading"
              id="pending-assignments"
            >
              <div class="skeleton-card large"></div>
            </div>
            <div class="stat-label">Require your attention</div>
          </div>
          <div class="card-footer">
            <span>Due this week: <span id="week-assignments">2</span></span>
            <span class="progress-change negative" id="assignments-change">
              <i class="fas fa-arrow-up"></i>
              <span id="assignments-percentage" class="skeleton-loading">
                <div class="skeleton-card small"></div>
              </span>
            </span>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Average Grade</div>
            <div class="card-icon bg-success">
              <i class="fas fa-chart-line"></i>
            </div>
          </div>
          <div class="card-content">
            <div
              class="stat-number success skeleton-loading"
              id="average-grade"
            >
              <div class="skeleton-card large"></div>
            </div>
            <div class="stat-label">Current semester performance</div>
          </div>
          <div class="card-footer">
            <span>Last assessment: <span id="grade-updated">Today</span></span>
            <span class="progress-change positive" id="grade-change">
              <i class="fas fa-arrow-up"></i>
              <span id="grade-percentage" class="skeleton-loading">
                <div class="skeleton-card small"></div>
              </span>
            </span>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Study Hours</div>
            <div class="card-icon bg-info">
              <i class="fas fa-clock"></i>
            </div>
          </div>
          <div class="card-content">
            <div class="stat-number info skeleton-loading" id="study-hours">
              <div class="skeleton-card large"></div>
            </div>
            <div class="stat-label">This month's total</div>
          </div>
          <div class="card-footer">
            <span>Daily average: <span id="daily-average">1.2h</span></span>
            <span class="progress-change positive" id="study-change">
              <i class="fas fa-arrow-up"></i>
              <span id="study-percentage" class="skeleton-loading">
                <div class="skeleton-card small"></div>
              </span>
            </span>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Completed Quizzes</div>
            <div class="card-icon bg-success">
              <i class="fas fa-check-circle"></i>
            </div>
          </div>
          <div class="card-content">
            <div
              class="stat-number success skeleton-loading"
              id="completed-quizzes"
            >
              <div class="skeleton-card large"></div>
            </div>
            <div class="stat-label">Out of 12 total quizzes</div>
          </div>
          <div class="card-footer">
            <span>Success rate: <span id="quiz-rate">85%</span></span>
            <span class="progress-change positive" id="quizzes-change">
              <i class="fas fa-arrow-up"></i>
              <span id="quizzes-percentage" class="skeleton-loading">
                <div class="skeleton-card small"></div>
              </span>
            </span>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Course Progress</div>
            <div class="card-icon bg-primary">
              <i class="fas fa-trophy"></i>
            </div>
          </div>
          <div class="card-content">
            <div
              class="stat-number primary skeleton-loading"
              id="course-progress"
            >
              <div class="skeleton-card large"></div>
            </div>
            <div class="stat-label">Overall completion rate</div>
          </div>
          <div class="card-footer">
            <span>On track: <span id="on-track">4/5</span> courses</span>
            <span class="progress-change positive" id="progress-change">
              <i class="fas fa-arrow-up"></i>
              <span id="progress-percentage" class="skeleton-loading">
                <div class="skeleton-card small"></div>
              </span>
            </span>
          </div>
        </div>
      </div>

      <!-- Upcoming Deadlines Section -->
      <div class="deadlines-section">
        <div class="section-header">
          <h2 class="section-title">Upcoming Deadlines</h2>
          <button class="view-all-btn" id="viewAllDeadlines">
            View All <i class="fas fa-arrow-right"></i>
          </button>
        </div>
        <div class="deadlines-grid" id="deadlinesGrid">
          <!-- Deadline cards will be dynamically loaded here -->
        </div>
      </div>

      <!-- Recent Activity Section -->
      <div class="activity-section">
        <div class="section-header">
          <h2 class="section-title">Recent Activity</h2>
          <button class="view-all-btn" id="viewAllActivity">
            View All <i class="fas fa-arrow-right"></i>
          </button>
        </div>
        <div class="activity-list" id="activityList">
          <!-- Activity items will be dynamically loaded here -->
        </div>
      </div>

      <!-- Performance Chart Section -->
      <div class="performance-section">
        <div class="section-header">
          <h2 class="section-title">Performance Overview</h2>
          <button class="view-all-btn" id="viewPerformanceDetails">
            Details <i class="fas fa-arrow-right"></i>
          </button>
        </div>
        <div class="performance-chart">
          <div class="chart-container" id="performanceChart">
            <!-- Chart will be rendered here -->
            <div class="loading-state">
              <i class="fas fa-spinner fa-spin"></i>
              <span class="loading-text">Loading performance data...</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div class="confirmation-modal" id="logoutConfirmationModal">
      <div class="confirmation-content">
        <div class="confirmation-icon">
          <i class="fas fa-sign-out-alt"></i>
        </div>
        <h3 class="confirmation-title">Confirm Logout</h3>
        <p class="confirmation-message">
          Are you sure you want to logout? You will need to sign in again to
          access the dashboard.
        </p>
        <div class="confirmation-actions">
          <button class="confirm-no" id="confirmNo">No, Cancel</button>
          <button class="confirm-yes" id="confirmYes">Yes, Logout</button>
        </div>
      </div>
    </div>

    <script>
      // Mobile Sidebar Toggle Functionality
      const sidebar = document.getElementById("sidebar");
      const mobileMenuBtn = document.getElementById("mobileMenuBtn");
      const hamburgerMenu = document.getElementById("hamburgerMenu");
      const overlay = document.getElementById("overlay");

      function toggleSidebar() {
        sidebar.classList.toggle("active");
        overlay.classList.toggle("active");
        document.body.style.overflow = sidebar.classList.contains("active")
          ? "hidden"
          : "";
      }

      mobileMenuBtn.addEventListener("click", toggleSidebar);
      hamburgerMenu.addEventListener("click", toggleSidebar);
      overlay.addEventListener("click", toggleSidebar);

      // Theme Management
      const themeToggleInput = document.getElementById("themeToggleInput");
      const sidebarThemeToggle = document.getElementById("sidebarThemeToggle");
      const htmlElement = document.documentElement;

      // Function to set theme
      function setTheme(theme) {
        htmlElement.setAttribute("data-theme", theme);
        localStorage.setItem("theme", theme);

        // Update toggle switch
        if (theme === "dark") {
          themeToggleInput.checked = true;
        } else {
          themeToggleInput.checked = false;
        }
      }

      // Function to toggle theme
      function toggleTheme() {
        const currentTheme = htmlElement.getAttribute("data-theme");
        const newTheme = currentTheme === "dark" ? "light" : "dark";
        setTheme(newTheme);
      }

      // Initialize theme
      function initTheme() {
        // Check for saved theme preference
        const savedTheme = localStorage.getItem("theme");

        if (savedTheme) {
          setTheme(savedTheme);
        } else {
          // Check system preference
          const prefersDark = window.matchMedia(
            "(prefers-color-scheme: dark)"
          ).matches;
          setTheme(prefersDark ? "dark" : "light");
        }
      }

      // Listen for system theme changes
      window
        .matchMedia("(prefers-color-scheme: dark)")
        .addEventListener("change", (e) => {
          // Only change if user hasn't set a preference
          if (!localStorage.getItem("theme")) {
            setTheme(e.matches ? "dark" : "light");
          }
        });

      // ‚öôÔ∏è API Configuration - Dynamic URL for localhost and Render
      const getApiBaseUrl = () => {
        // Check if we're on localhost
        if (
          window.location.hostname === "localhost" ||
          window.location.hostname === "127.0.0.1"
        ) {
          return "http://localhost:8000";
        }
        // For production (Render), use relative path (same domain)
        return "";
      };

      const API_BASE_URL = getApiBaseUrl();

      // Logout Confirmation Elements
      const sidebarLogoutBtn = document.getElementById("sidebarLogoutBtn");
      const logoutConfirmationModal = document.getElementById(
        "logoutConfirmationModal"
      );
      const confirmYes = document.getElementById("confirmYes");
      const confirmNo = document.getElementById("confirmNo");

      // Function to load and display current user info
      function loadCurrentUserInfo() {
        const token = localStorage.getItem("access_token");
        if (token) {
          try {
            // Decode the JWT token to get user information
            const payload = JSON.parse(atob(token.split(".")[1]));

            // Get email from token (adjust the property name based on your token structure)
            const userEmail = payload.email || payload.sub || "User";

            // Update the UI with user's email
            const userNameElement = document.getElementById("currentUserName");
            const userAvatarElement =
              document.getElementById("currentUserAvatar");
            const welcomeMessage = document.getElementById("welcomeMessage");

            if (userNameElement) {
              userNameElement.textContent = userEmail;
            }

            if (userAvatarElement) {
              userAvatarElement.textContent = getInitials(userEmail);
            }

            if (welcomeMessage) {
              // Extract first name from email or use username
              const firstName = userEmail.split("@")[0] || "Student";
              welcomeMessage.textContent = `Welcome back, ${firstName}!`;
            }
          } catch (e) {
            console.error("Error parsing token:", e);
            // Fallback to default
            const userNameElement = document.getElementById("currentUserName");
            const userAvatarElement =
              document.getElementById("currentUserAvatar");
            const welcomeMessage = document.getElementById("welcomeMessage");

            if (userNameElement) {
              userNameElement.textContent = "Student";
            }

            if (userAvatarElement) {
              userAvatarElement.textContent = "S";
            }

            if (welcomeMessage) {
              welcomeMessage.textContent = "Welcome back, Student!";
            }
          }
        }
      }

      // Helper function to get initials from email or name
      function getInitials(text) {
        if (!text) return "?";

        // If it's an email, use the part before @
        if (text.includes("@")) {
          const username = text.split("@")[0];
          return username.charAt(0).toUpperCase();
        }

        // If it's a name, use the first character
        return text.charAt(0).toUpperCase();
      }

      // Function to check if user is authenticated
      function checkAuthentication() {
        const token = localStorage.getItem("access_token");
        if (!token) {
          showToast(
            "warning",
            "Authentication Required",
            "Please log in to view dashboard data",
            4000
          );
          setTimeout(() => {
            window.location.href = "/static/signin.html";
          }, 2000);
          return false;
        }
        return true;
      }

      // Function to fetch data from API with proper authentication
      async function fetchData(endpoint) {
        try {
          const token = localStorage.getItem("access_token");
          const headers = {
            "Content-Type": "application/json",
          };

          if (token) {
            headers["Authorization"] = `Bearer ${token}`;
          }

          console.log(`üîç Fetching from: ${API_BASE_URL}${endpoint}`);

          const response = await fetch(`${API_BASE_URL}${endpoint}`, {
            method: "GET",
            headers: headers,
          });

          console.log(
            `üìä Response status: ${response.status} ${response.statusText}`
          );

          if (response.status === 401) {
            showToast(
              "warning",
              "Session Expired",
              "Please log in again",
              3000
            );
            setTimeout(() => {
              window.location.href = "/static/signin.html";
            }, 2000);
            return null;
          }

          if (!response.ok) {
            const errorText = await response.text();
            console.error(
              `‚ùå HTTP error! status: ${response.status}`,
              errorText
            );
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          console.log(`‚úÖ Fetched data from ${endpoint}:`, data);
          return data;
        } catch (error) {
          console.error(`‚ùå Error fetching data from ${endpoint}:`, error);
          return null;
        }
      }

      // Function to fetch student-specific data
      async function fetchStudentData() {
        console.log("üîÑ Fetching student dashboard data...");

        // Check authentication first
        if (!checkAuthentication()) {
          return;
        }

        try {
          // Fetch all student data in parallel
          const [courses, assignments, grades, progress, deadlines, activity] =
            await Promise.all([
              fetchData("/students/courses"),
              fetchData("/students/assignments"),
              fetchData("/students/grades"),
              fetchData("/students/progress"),
              fetchData("/students/deadlines"),
              fetchData("/students/activity"),
            ]);

          console.log("üì¶ Student data fetched:", {
            courses: courses?.length || 0,
            assignments: assignments?.length || 0,
            grades: grades?.length || 0,
            progress: progress ? "Yes" : "No",
            deadlines: deadlines?.length || 0,
            activity: activity?.length || 0,
          });

          updateStudentUI(
            courses,
            assignments,
            grades,
            progress,
            deadlines,
            activity
          );
        } catch (error) {
          console.error("‚ùå Error in fetchStudentData:", error);
          showToast(
            "error",
            "Data Fetch Error",
            "Could not load student dashboard data. Please try again.",
            5000
          );

          // Load mock data for demonstration
          loadMockData();
        }
      }

      // Function to update UI with student data
      function updateStudentUI(
        courses,
        assignments,
        grades,
        progress,
        deadlines,
        activity
      ) {
        console.log("üé® Updating UI with student data");

        // Calculate statistics
        const enrolledCourses = courses ? courses.length : 0;
        const pendingAssignments = assignments
          ? assignments.filter(
              (a) => a.status === "pending" || a.status === "in_progress"
            ).length
          : 0;
        const averageGrade =
          grades && grades.length
            ? Math.round(
                grades.reduce((sum, g) => sum + g.score, 0) / grades.length
              )
            : 0;
        const studyHours = progress ? progress.study_hours || 0 : 0;
        const completedQuizzes = progress ? progress.completed_quizzes || 0 : 0;
        const courseProgress = progress
          ? Math.round(progress.overall_progress || 0)
          : 0;

        // Update overview cards
        updateStatElement("enrolled-courses", enrolledCourses);
        updateStatElement("pending-assignments", pendingAssignments);
        updateStatElement("average-grade", `${averageGrade}%`);
        updateStatElement("study-hours", `${studyHours}h`);
        updateStatElement("completed-quizzes", completedQuizzes);
        updateStatElement("course-progress", `${courseProgress}%`);

        // Update welcome banner
        updateWelcomeBanner(pendingAssignments, deadlines);

        // Update deadlines section
        renderDeadlines(deadlines);

        // Update activity section
        renderActivity(activity);

        // Update performance chart
        renderPerformanceChart(grades, progress);

        // Update timestamps
        const now = new Date();
        document
          .querySelectorAll("#courses-updated, #grade-updated")
          .forEach((el) => {
            el.textContent = formatDate(now);
          });

        console.log("‚úÖ Student dashboard updated successfully");
      }

      // Function to update welcome banner
      function updateWelcomeBanner(pendingCount, deadlines) {
        const pendingCountElement = document.getElementById("pendingCount");
        const upcomingCountElement = document.getElementById("upcomingCount");

        if (pendingCountElement) {
          pendingCountElement.textContent = pendingCount;
        }

        if (upcomingCountElement) {
          const upcomingDeadlines = deadlines
            ? deadlines.filter((d) => new Date(d.due_date) > new Date()).length
            : 0;
          upcomingCountElement.textContent = upcomingDeadlines;
        }
      }

      // Function to render deadlines
      function renderDeadlines(deadlines) {
        const deadlinesGrid = document.getElementById("deadlinesGrid");

        if (!deadlinesGrid) return;

        if (!deadlines || deadlines.length === 0) {
          deadlinesGrid.innerHTML = `
            <div class="deadline-card" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
              <i class="fas fa-check-circle" style="font-size: 3rem; color: var(--success-green); margin-bottom: 15px;"></i>
              <h3 style="color: var(--text-primary); margin-bottom: 10px;">No Upcoming Deadlines</h3>
              <p style="color: var(--text-muted);">You're all caught up! Great work!</p>
            </div>
          `;
          return;
        }

        // Sort deadlines by due date
        const sortedDeadlines = deadlines.sort(
          (a, b) => new Date(a.due_date) - new Date(b.due_date)
        );

        // Take only the next 4 deadlines
        const displayDeadlines = sortedDeadlines.slice(0, 4);

        deadlinesGrid.innerHTML = displayDeadlines
          .map((deadline) => {
            const dueDate = new Date(deadline.due_date);
            const now = new Date();
            const timeDiff = dueDate - now;
            const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

            let dateClass = "near";
            let statusText = "Due soon";

            if (daysDiff <= 1) {
              dateClass = "urgent";
              statusText = "Due tomorrow";
            } else if (daysDiff <= 3) {
              dateClass = "urgent";
              statusText = `Due in ${daysDiff} days`;
            } else if (daysDiff <= 7) {
              statusText = `Due in ${daysDiff} days`;
            } else {
              statusText = formatDate(dueDate);
            }

            let progressClass = "pending";
            let progressWidth = "30%";

            if (deadline.progress >= 100) {
              progressClass = "completed";
              progressWidth = "100%";
            } else if (deadline.progress >= 50) {
              progressClass = "in-progress";
              progressWidth = "60%";
            }

            return `
            <div class="deadline-card ${daysDiff <= 3 ? "urgent" : ""}">
              <div class="deadline-header">
                <div>
                  <div class="deadline-title">${deadline.title}</div>
                  <div class="deadline-course">${deadline.course_name}</div>
                </div>
                <div class="deadline-date ${dateClass}">${statusText}</div>
              </div>
              <div class="deadline-progress">
                <div class="progress-bar">
                  <div class="progress-fill ${progressClass}" style="width: ${progressWidth}"></div>
                </div>
                <div class="progress-text">
                  <span>Progress</span>
                  <span>${deadline.progress || 0}%</span>
                </div>
              </div>
            </div>
          `;
          })
          .join("");
      }

      // Function to render activity
      function renderActivity(activity) {
        const activityList = document.getElementById("activityList");

        if (!activityList) return;

        if (!activity || activity.length === 0) {
          activityList.innerHTML = `
            <div class="activity-item" style="text-align: center; padding: 40px;">
              <i class="fas fa-history" style="font-size: 2rem; color: var(--text-muted); margin-bottom: 15px;"></i>
              <h3 style="color: var(--text-primary); margin-bottom: 10px;">No Recent Activity</h3>
              <p style="color: var(--text-muted);">Your activity will appear here as you engage with courses.</p>
            </div>
          `;
          return;
        }

        // Sort activity by timestamp (newest first)
        const sortedActivity = activity.sort(
          (a, b) => new Date(b.timestamp) - new Date(a.timestamp)
        );

        // Take only the latest 5 activities
        const displayActivity = sortedActivity.slice(0, 5);

        activityList.innerHTML = displayActivity
          .map((item) => {
            let iconClass = "course";
            let icon = "fas fa-book";

            switch (item.type) {
              case "assignment":
                iconClass = "assignment";
                icon = "fas fa-tasks";
                break;
              case "quiz":
                iconClass = "quiz";
                icon = "fas fa-question-circle";
                break;
              case "completion":
                iconClass = "completed";
                icon = "fas fa-check-circle";
                break;
              default:
                iconClass = "course";
                icon = "fas fa-book";
            }

            const timeAgo = getTimeAgo(new Date(item.timestamp));

            return `
            <div class="activity-item">
              <div class="activity-icon ${iconClass}">
                <i class="${icon}"></i>
              </div>
              <div class="activity-content">
                <div class="activity-title">${item.title}</div>
                <div class="activity-desc">${item.description}</div>
              </div>
              <div class="activity-time">${timeAgo}</div>
            </div>
          `;
          })
          .join("");
      }

      // Function to render performance chart
      function renderPerformanceChart(grades, progress) {
        const chartContainer = document.getElementById("performanceChart");

        if (!chartContainer) return;

        // For now, we'll create a simple text-based performance summary
        // In a real implementation, you would use a charting library like Chart.js

        if (!grades || grades.length === 0) {
          chartContainer.innerHTML = `
            <div style="text-align: center; padding: 40px;">
              <i class="fas fa-chart-line" style="font-size: 3rem; color: var(--text-muted); margin-bottom: 15px;"></i>
              <h3 style="color: var(--text-primary); margin-bottom: 10px;">No Performance Data Yet</h3>
              <p style="color: var(--text-muted);">Complete some assignments to see your performance metrics.</p>
            </div>
          `;
          return;
        }

        // Calculate some basic performance metrics
        const recentGrades = grades.slice(-5); // Last 5 grades
        const gradeValues = recentGrades.map((g) => g.score);
        const averageGrade =
          gradeValues.reduce((sum, grade) => sum + grade, 0) /
          gradeValues.length;

        const improvement =
          grades.length >= 2
            ? grades[grades.length - 1].score - grades[0].score
            : 0;

        chartContainer.innerHTML = `
          <div style="padding: 20px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
              <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: var(--primary-indigo);">${Math.round(
                  averageGrade
                )}%</div>
                <div style="color: var(--text-muted); font-size: 0.9rem;">Average Grade</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: ${
                  improvement >= 0 ? "var(--success-green)" : "var(--error-red)"
                };">${improvement >= 0 ? "+" : ""}${Math.round(
          improvement
        )}%</div>
                <div style="color: var(--text-muted); font-size: 0.9rem;">Improvement</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: var(--info-blue);">${
                  grades.length
                }</div>
                <div style="color: var(--text-muted); font-size: 0.9rem;">Assessments</div>
              </div>
            </div>
            <div style="background: var(--skeleton-bg); height: 120px; border-radius: 8px; display: flex; align-items: end; padding: 10px; gap: 10px;">
              ${gradeValues
                .map((grade, index) => {
                  const height = (grade / 100) * 100;
                  const color =
                    grade >= 80
                      ? "var(--success-green)"
                      : grade >= 70
                      ? "var(--warning-orange)"
                      : "var(--error-red)";
                  return `<div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                  <div style="width: 20px; height: ${height}px; background: ${color}; border-radius: 4px 4px 0 0;"></div>
                  <div style="font-size: 0.7rem; margin-top: 5px; color: var(--text-muted);">${
                    index + 1
                  }</div>
                </div>`;
                })
                .join("")}
            </div>
            <div style="text-align: center; margin-top: 15px; color: var(--text-muted); font-size: 0.9rem;">
              Recent Assessment Performance
            </div>
          </div>
        `;
      }

      // Helper function to get time ago string
      function getTimeAgo(date) {
        const now = new Date();
        const diffMs = now - date;
        const diffMins = Math.floor(diffMs / (1000 * 60));
        const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

        if (diffMins < 1) return "Just now";
        if (diffMins < 60) return `${diffMins}m ago`;
        if (diffHours < 24) return `${diffHours}h ago`;
        if (diffDays < 7) return `${diffDays}d ago`;

        return formatDate(date);
      }

      // Helper function to format date
      function formatDate(date) {
        return new Date(date).toLocaleDateString("en-US", {
          month: "short",
          day: "numeric",
        });
      }

      // Helper function to update stat elements and remove loading state
      function updateStatElement(elementId, value) {
        const element = document.getElementById(elementId);
        if (element) {
          element.innerHTML = "";
          element.textContent = value;
          element.classList.remove("skeleton-loading");
        }
      }

      // Load mock data for demonstration (when API is not available)
      function loadMockData() {
        console.log("üìã Loading mock data for demonstration");

        const mockCourses = [
          { id: 1, title: "Web Development", progress: 75 },
          { id: 2, title: "Data Structures", progress: 60 },
          { id: 3, title: "Database Design", progress: 90 },
          { id: 4, title: "UI/UX Design", progress: 45 },
          { id: 5, title: "Mobile Development", progress: 30 },
        ];

        const mockAssignments = [
          {
            id: 1,
            title: "Final Project",
            course_name: "Web Development",
            due_date: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000),
            progress: 60,
            status: "in_progress",
          },
          {
            id: 2,
            title: "Algorithm Analysis",
            course_name: "Data Structures",
            due_date: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000),
            progress: 30,
            status: "pending",
          },
          {
            id: 3,
            title: "Database Design",
            course_name: "Database Design",
            due_date: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000),
            progress: 90,
            status: "in_progress",
          },
          {
            id: 4,
            title: "UI Prototype",
            course_name: "UI/UX Design",
            due_date: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
            progress: 20,
            status: "pending",
          },
        ];

        const mockGrades = [
          {
            id: 1,
            title: "Midterm Exam",
            score: 85,
            course: "Web Development",
          },
          { id: 2, title: "Quiz 1", score: 92, course: "Data Structures" },
          {
            id: 3,
            title: "Assignment 3",
            score: 78,
            course: "Database Design",
          },
          { id: 4, title: "Final Project", score: 88, course: "UI/UX Design" },
          {
            id: 5,
            title: "Lab Exercise",
            score: 95,
            course: "Mobile Development",
          },
        ];

        const mockProgress = {
          study_hours: 24,
          completed_quizzes: 8,
          overall_progress: 65,
        };

        const mockDeadlines = mockAssignments;

        const mockActivity = [
          {
            id: 1,
            type: "assignment",
            title: "Submitted Final Project",
            description: "Web Development - Final submission",
            timestamp: new Date(Date.now() - 2 * 60 * 60 * 1000),
          },
          {
            id: 2,
            type: "quiz",
            title: "Completed Quiz 5",
            description: "Data Structures - Score: 92%",
            timestamp: new Date(Date.now() - 5 * 60 * 60 * 1000),
          },
          {
            id: 3,
            type: "completion",
            title: "Finished Module 3",
            description: "Database Design - Advanced Queries",
            timestamp: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000),
          },
          {
            id: 4,
            type: "assignment",
            title: "Started UI Prototype",
            description: "UI/UX Design - Initial wireframes",
            timestamp: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000),
          },
          {
            id: 5,
            type: "quiz",
            title: "Attempted Practice Quiz",
            description: "Mobile Development - React Native basics",
            timestamp: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000),
          },
        ];

        updateStudentUI(
          mockCourses,
          mockAssignments,
          mockGrades,
          mockProgress,
          mockDeadlines,
          mockActivity
        );

        showToast(
          "info",
          "Demo Mode",
          "Using mock data for demonstration. Connect to backend for real data.",
          5000
        );
      }

      // Toast Notification System
      function showToast(type, title, message, duration = 5000) {
        let toastContainer = document.getElementById("toastContainer");
        if (!toastContainer) {
          toastContainer = document.createElement("div");
          toastContainer.id = "toastContainer";
          toastContainer.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
          `;
          document.body.appendChild(toastContainer);
        }

        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.style.cssText = `
          background: var(--card-bg);
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          padding: 16px;
          margin-bottom: 10px;
          border-left: 4px solid;
          display: flex;
          align-items: center;
          opacity: 0;
          transform: translateX(100%);
          transition: all 0.3s ease;
          pointer-events: all;
          max-width: 350px;
          backdrop-filter: blur(10px);
        `;

        // Set border color based on type
        const colors = {
          success: "var(--success-green)",
          info: "var(--primary-indigo)",
          warning: "var(--warning-orange)",
          error: "var(--error-red)",
        };
        toast.style.borderLeftColor = colors[type] || colors.info;

        const icons = {
          success: "fas fa-check",
          info: "fas fa-info-circle",
          warning: "fas fa-exclamation-triangle",
          error: "fas fa-exclamation-circle",
        };

        toast.innerHTML = `
          <div class="toast-icon" style="margin-right: 12px; font-size: 20px; color: ${
            colors[type] || colors.info
          }">
            <i class="${icons[type]}"></i>
          </div>
          <div class="toast-content" style="flex: 1;">
            <div class="toast-title" style="font-weight: bold; margin-bottom: 4px;">${title}</div>
            <div class="toast-message" style="color: var(--text-secondary); font-size: 14px;">${message}</div>
          </div>
          <button class="toast-close" style="background: none; border: none; font-size: 16px; cursor: pointer; color: var(--text-muted); margin-left: 12px;">
            <i class="fas fa-times"></i>
          </button>
        `;

        toastContainer.appendChild(toast);

        // Show toast with animation
        setTimeout(() => {
          toast.style.opacity = "1";
          toast.style.transform = "translateX(0)";
        }, 100);

        // Close button functionality
        const closeBtn = toast.querySelector(".toast-close");
        closeBtn.addEventListener("click", () => {
          hideToast(toast);
        });

        // Auto-hide after duration
        if (duration > 0) {
          setTimeout(() => {
            hideToast(toast);
          }, duration);
        }

        return toast;
      }

      function hideToast(toast) {
        toast.style.opacity = "0";
        toast.style.transform = "translateX(100%)";
        setTimeout(() => {
          if (toast.parentNode) {
            toast.parentNode.removeChild(toast);
          }
        }, 300);
      }

      // Setup logout confirmation functionality
      function setupLogoutConfirmation() {
        sidebarLogoutBtn.addEventListener("click", function (e) {
          e.preventDefault();
          logoutConfirmationModal.style.display = "block";
        });

        confirmNo.addEventListener("click", function () {
          logoutConfirmationModal.style.display = "none";
        });

        confirmYes.addEventListener("click", function () {
          showToast(
            "info",
            "Logging Out",
            "You have been logged out successfully",
            500
          );

          // Clear authentication tokens
          localStorage.removeItem("access_token");
          localStorage.removeItem("refresh_token");
          localStorage.removeItem("dashboard_previous_data");

          setTimeout(() => {
            window.location.href = "/static/signin.html";
          }, 500);
        });

        // Close logout confirmation modal when clicking outside
        window.addEventListener("click", function (event) {
          if (event.target === logoutConfirmationModal) {
            logoutConfirmationModal.style.display = "none";
          }
        });
      }

      // Setup button event listeners
      function setupEventListeners() {
        // View All Deadlines button
        const viewAllDeadlines = document.getElementById("viewAllDeadlines");
        if (viewAllDeadlines) {
          viewAllDeadlines.addEventListener("click", function () {
            showToast(
              "info",
              "Navigation",
              "Redirecting to assignments page",
              2000
            );
            setTimeout(() => {
              window.location.href = "student-assignments.html";
            }, 1000);
          });
        }

        // View All Activity button
        const viewAllActivity = document.getElementById("viewAllActivity");
        if (viewAllActivity) {
          viewAllActivity.addEventListener("click", function () {
            showToast(
              "info",
              "Navigation",
              "Redirecting to activity page",
              2000
            );
            setTimeout(() => {
              window.location.href = "student-progress.html";
            }, 1000);
          });
        }

        // View Performance Details button
        const viewPerformanceDetails = document.getElementById(
          "viewPerformanceDetails"
        );
        if (viewPerformanceDetails) {
          viewPerformanceDetails.addEventListener("click", function () {
            showToast("info", "Navigation", "Redirecting to grades page", 2000);
            setTimeout(() => {
              window.location.href = "student-grades.html";
            }, 1000);
          });
        }
      }

      // Initialize dashboard
      document.addEventListener("DOMContentLoaded", function () {
        console.log("Student Dashboard initializing...");

        // Initialize theme first
        initTheme();

        // Set up theme toggle
        themeToggleInput.addEventListener("change", toggleTheme);
        sidebarThemeToggle.addEventListener("click", function () {
          themeToggleInput.checked = !themeToggleInput.checked;
          toggleTheme();
        });

        // Load current user info first
        loadCurrentUserInfo();

        // Setup logout confirmation
        setupLogoutConfirmation();

        // Setup button event listeners
        setupEventListeners();

        // Load data immediately
        fetchStudentData();

        // Set up periodic refresh (every 2 minutes)
        setInterval(() => {
          console.log("Refreshing student dashboard data...");
          fetchStudentData();
        }, 120000);

        // Add active class to clicked sidebar items
        const sidebarItems = document.querySelectorAll(".sidebar-menu a");
        sidebarItems.forEach((item) => {
          item.addEventListener("click", function () {
            sidebarItems.forEach((i) => i.classList.remove("active"));
            this.classList.add("active");

            // Close sidebar on mobile after clicking a link
            if (window.innerWidth <= 992) {
              toggleSidebar();
            }
          });
        });
      });
    </script>
  </body>
</html>
